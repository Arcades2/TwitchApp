"use strict";var app=angular.module("twitchApiApp",["ngAnimate","ngCookies","ngResource","ngRoute","ngSanitize","ngTouch"]);app.controller("mainController",["$scope","auth","$location","parse","getStreams","$interval",function(a,b,c,d,e,f){function g(){b.getCookie("token")?i=b.getCookie("token"):c.hash()&&(i=d.parse(c.hash(),"&").access_token),i&&b.getUser(i).then(function(c){a.authenticated=!0,a.username=c.token.user_name,b.setCookie(i),e.getFollowedStreams(h,i).then(function(b){a.streams=b.streams},function(a){console.log(a)})},function(a){console.log("error : "+a)}),e.getTopStream(h).then(function(b){a.actualStream=b.streams[0].channel.name},function(a){console.log(a)})}var h="o7uz4yl43vuwdurmvikzjji7ixxvsv",i="";a.redirect=function(){window.location="https://api.twitch.tv/kraken/oauth2/authorize?response_type=token&client_id="+h+"&redirect_uri=http://localhost:9000&force_verify=true&scope=user_read"},a.disconnect=function(){a.authenticated=!1,i="",b.removeCookie()},a.authenticated=!1,a.setActualStream=function(b){a.actualStream=b,angular.element("html, body").animate({scrollTop:angular.element("#player").offset().top-20},"slow")},f(function(){e.getFollowedStreams(h,i).then(function(b){a.streams=b.streams},function(a){console.log("err:"+a)})},12e4),g()}]),app.factory("auth",["$http","$q","$cookies",function(a,b,c){return{getUser:function(c){var d=b.defer();return a.get("https://api.twitch.tv/kraken?oauth_token="+c).then(function(a){d.resolve(a.data)},function(a){d.reject(a.data)}),d.promise},setCookie:function(a){c.putObject("token",a)},getCookie:function(){return c.getObject("token")},removeCookie:function(){c.remove("token")}}}]),app.factory("parse",function(){return{parse:function(a,b){for(var c,d={},e=a.split(b),f=0,g=e.length;g>f;++f)c=e[f].split("="),c[0]&&(d[c[0]]=c[1]);return d}}}),app.factory("getStreams",["$http","$q",function(a,b){return{getFollowedStreams:function(c,d){var e=b.defer();return a({method:"GET",url:"https://api.twitch.tv/kraken/streams/followed",headers:{"Client-ID":c,Authorization:"OAuth "+d}}).then(function(a){e.resolve(a.data)},function(a){e.reject(a.data)}),e.promise},getTopStream:function(c){var d=b.defer();return a({method:"GET",url:"https://api.twitch.tv/kraken/streams?limit=1",headers:{"Client-ID":c}}).then(function(a){d.resolve(a.data)},function(a){d.reject(a.data)}),d.promise}}}]),app.directive("thumbnail",function(){return{restrict:"E",scope:{stream:"=stream"},templateUrl:"../../views/partial/thumbnail.html"}}),app.directive("twitchplayer",function(){return{restrict:"E",scope:{name:"=name"},templateUrl:"../../views/partial/twitchplayer.html"}}),app.filter("twitchEmbedUrl",["$sce",function(a){return function(b){return a.trustAsResourceUrl("http://player.twitch.tv/?channel="+b)}}]);